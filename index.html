<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>tete — interior design</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@200;300;400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css?v=3" />
</head>
<body>
  <a class="skip" href="#content">Skip to content</a>

  <header class="header">
    <div class="wrap">
      <nav class="nav" aria-label="Primary">
        <a class="brand" href="./">
          <span class="logo">tete</span>
          <span class="tag">interior design</span>
        </a>

        <div class="navRight">
          <div class="navLinks">
            <a href="#projects">Projects</a>
            <a href="#journal">Journal</a>
            <a href="#contact">Contact</a>
          </div>

          <a class="iconLink" href="mailto:tetiana.korolyuk@gmail.com" aria-label="Email">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 6h16v12H4V6Z" stroke="currentColor" stroke-width="1.6"/>
              <path d="m4 7 8 6 8-6" stroke="currentColor" stroke-width="1.6"/>
            </svg>
            Email
          </a>

          <button class="hamburger" type="button" data-nav-toggle aria-expanded="false" aria-label="Open menu">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M5 7h14M5 12h14M5 17h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="square"/>
            </svg>
          </button>
        </div>
      </nav>

      <div class="mobilePanel" data-nav>
        <a href="#projects">Projects</a>
        <a href="#journal">Journal</a>
        <a href="#contact">Contact</a>
        <a href="mailto:tetiana.korolyuk@gmail.com">Email</a>
      </div>
    </div>
  </header>

  <!-- Full-bleed hero carousel (no container) -->
  <section class="hero" aria-label="Featured images">
    <div class="stage" aria-hidden="true">
      <img id="imgA" class="layer isActive" src="images/project-01-a.jpg" alt="" />
      <img id="imgB" class="layer" src="images/project-01-b.jpg" alt="" />
    </div>

    <div class="heroInner">
      <div class="wrap">
        <p class="kicker"><span class="rule"></span>Selected works</p>
        <h1>tete</h1>
        <p class="lead">Minimal interior design. Projects below.</p>

        <div class="heroBar">
          <div class="hint"><span class="dot" aria-hidden="true"></span>Scroll</div>
          <p class="caption" id="heroCaption">Image 1 of 6</p>
          <div class="progress" aria-hidden="true"><div class="progressFill" id="progressFill"></div></div>
        </div>
      </div>
    </div>

    <div class="heroUI">
      <button class="navBtn" id="prevSlide" type="button">Prev</button>
      <div class="dots" id="dots" aria-label="Carousel navigation"></div>
      <button class="navBtn" id="nextSlide" type="button">Next</button>
    </div>
  </section>

  <main id="content">
    <section class="section" id="projects">
      <div class="wrap">
        <p class="subkicker"><span class="rule"></span>Projects</p>
        <div class="sectionTitleLine">
          <h2>Selected Works</h2>
          <div class="meta metaRow">Click a project to expand or open</div>
        </div>

        <div id="projectsMount"></div>
      </div>
    </section>

    <section class="section" id="journal">
      <div class="wrap">
        <p class="subkicker"><span class="rule"></span>Journal</p>
        <div class="sectionTitleLine">
          <h2>Latest writing</h2>
          <div class="meta metaRow">
            <a href="https://tekofm.substack.com/" target="_blank" rel="noopener">tekofm.substack.com</a>
          <button class="postsRefresh" id="postsRefresh" type="button" aria-label="Refresh posts">Refresh</button></div>
        </div>

        <div style="margin-top:18px;" id="postsMount" class="posts">
          <div class="postsEmpty">Loading posts…</div>
        </div>
      </div>
    </section>

    <section class="section" id="contact">
      <div class="wrap">
        <p class="subkicker"><span class="rule"></span>Contact</p>
        <div class="sectionTitleLine">
          <h2>Let’s talk.</h2>
          <div class="meta">Toronto · available for collaborations</div>
        </div>
        <div style="margin-top:18px;">
          <a class="iconLink" href="mailto:tetiana.korolyuk@gmail.com">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 6h16v12H4V6Z" stroke="currentColor" stroke-width="1.6"/>
              <path d="m4 7 8 6 8-6" stroke="currentColor" stroke-width="1.6"/>
            </svg>
            tetiana.korolyuk@gmail.com
          </a>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="wrap">
      <div class="footerRow">
        <div>tete — interior design</div>
        <div>
          <a href="https://substack.com/@tekorolyuk" target="_blank" rel="noopener">Substack profile</a>
          &nbsp;·&nbsp;
          <a href="#projects">Selected Works</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Lightbox (shared) -->
  <div class="lightbox" id="lightbox" aria-hidden="true" role="dialog" aria-label="Image viewer">
    <div class="lightboxInner">
      <div class="lbTop">
        <div class="lbCaption" id="lbCaption">Image</div>
        <div class="lbBtns">
          <button class="lbBtn" id="lbPrev" type="button">Prev</button>
          <button class="lbBtn" id="lbNext" type="button">Next</button>
          <button class="lbBtn" id="lbClose" type="button">Close</button>
        </div>
      </div>
      <img class="lbImg" id="lbImg" src="" alt="" />
    </div>
  </div>

  <script src="projects.js?v=3"></script>
  <script src="site.js?v=3"></script>
  <script>
    (function () {
      const PROJECTS = Array.isArray(window.PROJECTS) ? window.PROJECTS : [];

      // --- HERO CAROUSEL ---
      const imgA = document.getElementById("imgA");
      const imgB = document.getElementById("imgB");
      const caption = document.getElementById("heroCaption");
      const prevBtn = document.getElementById("prevSlide");
      const nextBtn = document.getElementById("nextSlide");
      const dotsEl = document.getElementById("dots");
      const progressFill = document.getElementById("progressFill");

      const slides = PROJECTS.flatMap(p => (p.images || []).map((src, i) => ({
        src,
        text: `${p.title} — ${p.subtitle || ""}`.replace(" — ", p.subtitle ? " — " : ""),
        alt: `${p.title} photo ${i + 1}`
      })));

      let idx = 0;
      let showingA = true;
      const intervalMs = 5200;
      let t0 = performance.now();
      let timer = null;

      function setActive(i) {
        if (!slides.length) return;
        idx = (i + slides.length) % slides.length;
        const s = slides[idx];

        const active = showingA ? imgA : imgB;
        const idle = showingA ? imgB : imgA;

        idle.src = s.src;
        idle.alt = s.alt || "";
        idle.classList.add("isActive");
        active.classList.remove("isActive");
        showingA = !showingA;

        if (caption) caption.textContent = `Image ${idx + 1} of ${slides.length}`;
        [...dotsEl.children].forEach((b, k) => b.classList.toggle("isActive", k === idx));
        t0 = performance.now();
      }

      function buildDots() {
        if (!dotsEl) return;
        dotsEl.innerHTML = slides.map((_, i) => `<button class="dotBtn ${i===0?"isActive":""}" type="button" aria-label="Go to image ${i+1}"></button>`).join("");
        [...dotsEl.children].forEach((b, i) => b.addEventListener("click", () => {
          setActive(i);
          restart();
        }));
      }

      function tick(now) {
        const elapsed = now - t0;
        const pct = Math.min(1, elapsed / intervalMs);
        if (progressFill) progressFill.style.width = (pct * 100) + "%";
        if (pct >= 1) {
          setActive(idx + 1);
        }
        requestAnimationFrame(tick);
      }

      function restart() {
        clearInterval(timer);
        timer = setInterval(() => setActive(idx + 1), intervalMs);
      }

      if (slides.length) {
        imgA.src = slides[0].src;
        imgA.alt = slides[0].alt || "";
        imgB.src = slides[1] ? slides[1].src : slides[0].src;
        imgB.alt = slides[1] ? (slides[1].alt || "") : (slides[0].alt || "");
        buildDots();
        restart();
        requestAnimationFrame(tick);
      }

      prevBtn?.addEventListener("click", () => { setActive(idx - 1); restart(); });
      nextBtn?.addEventListener("click", () => { setActive(idx + 1); restart(); });

      // --- PROJECTS RENDER ---
      const mount = document.getElementById("projectsMount");
      if (mount) {
        mount.innerHTML = PROJECTS.map((p, i) => {
          const img1 = (p.images && p.images[0]) ? p.images[0] : "";
          const img2 = (p.images && p.images[1]) ? p.images[1] : img1;

          const facts = Array.isArray(p.facts) ? p.facts : [];
          const factsHtml = facts.map(([k,v]) => `
            <div class="factRow"><b>${escapeHtml(k)}</b><span>${escapeHtml(v)}</span></div>
          `).join("");

          const expandId = `expand-${p.slug}`;

          return `
            <article class="projectBlock" data-slug="${escapeHtml(p.slug)}">
              <div class="sectionTitleLine">
                <h2>${escapeHtml(p.title)}</h2>
                <div class="meta">${escapeHtml(p.subtitle || "")}</div>
              </div>

              <div class="projectMedia" tabindex="-1">
                <div class="grid2">
                  <img class="projectImg" data-lightbox="${i}" data-i="0" src="${escapeHtml(img1)}" alt="${escapeHtml(p.title)} image 1">
                  <img class="projectImg" data-lightbox="${i}" data-i="1" src="${escapeHtml(img2)}" alt="${escapeHtml(p.title)} image 2">
                </div>

                <div class="projectOverlay">
                  <div class="projectOverlayCard">
                    <div>
                      <p class="projectOverlayTitle"><span class="pin" aria-hidden="true"></span>${escapeHtml(p.title)} — ${escapeHtml(p.subtitle || "")}</p>
                      <p class="projectOverlayText">${escapeHtml(p.description || "")}</p>
                    </div>
                    <div class="overlayActions">
                      <button class="overlayBtn" type="button" data-toggle="${escapeHtml(p.slug)}" aria-expanded="false" aria-controls="${expandId}">
                        More
                        <span class="ico" aria-hidden="true">
                          <svg viewBox="0 0 24 24" fill="none"><path d="M9 6.5 15 12l-6 5.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="square"/></svg>
                        </span>
                      </button>
                      <a class="overlayLink" href="project.html?p=${encodeURIComponent(p.slug)}">
                        Open
                        <span class="ico" aria-hidden="true">
                          <svg viewBox="0 0 24 24" fill="none"><path d="M9 6.5 15 12l-6 5.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="square"/></svg>
                        </span>
                      </a>
                    </div>
                  </div>
                </div>
              </div>

              <div class="projectExpand" id="${expandId}">
                <div class="projectExpandInner">
                  <p class="projectDesc">${escapeHtml(p.description || "")}</p>
                  <div class="facts">${factsHtml || "<div class='factRow'><b>Info</b><span>—</span></div>"}</div>
                </div>
              </div>
            </article>
          `;
        }).join("");
      }

      // --- More toggles (no overlap, aligned) ---
      document.addEventListener("click", (e) => {
        const btn = e.target.closest("[data-toggle]");
        if (!btn) return;

        const slug = btn.getAttribute("data-toggle");
        const block = btn.closest(".projectBlock");
        const panel = document.getElementById(`expand-${slug}`);
        if (!block || !panel) return;

        const open = !block.classList.contains("isOpen");

        // close others
        document.querySelectorAll(".projectBlock.isOpen").forEach(b => {
          if (b !== block) {
            b.classList.remove("isOpen");
            const bbtn = b.querySelector("[data-toggle]");
            if (bbtn) bbtn.setAttribute("aria-expanded", "false");
          }
        });

        block.classList.toggle("isOpen", open);
        btn.setAttribute("aria-expanded", open ? "true" : "false");

        if (open) {
          const y = block.getBoundingClientRect().top + window.scrollY - 92;
          window.scrollTo({ top: y, behavior: "smooth" });
        }
      });

      // --- Lightbox (click any project image) ---
      const lb = document.getElementById("lightbox");
      const lbImg = document.getElementById("lbImg");
      const lbCaption = document.getElementById("lbCaption");
      const lbPrev = document.getElementById("lbPrev");
      const lbNext = document.getElementById("lbNext");
      const lbClose = document.getElementById("lbClose");

      let activeProjectIndex = 0;
      let activeImageIndex = 0;

      function imagesForProject(pi) {
        return (PROJECTS[pi] && Array.isArray(PROJECTS[pi].images)) ? PROJECTS[pi].images : [];
      }

      function openLightbox(pi, ii) {
        const imgs = imagesForProject(pi);
        if (!imgs.length) return;

        activeProjectIndex = pi;
        activeImageIndex = Math.max(0, Math.min(imgs.length - 1, ii));

        lbImg.src = imgs[activeImageIndex];
        lbImg.alt = `${PROJECTS[pi].title} — image ${activeImageIndex + 1}`;
        lbCaption.textContent = `${PROJECTS[pi].title} — ${activeImageIndex + 1} / ${imgs.length}`;

        lb.classList.add("isOpen");
        lb.setAttribute("aria-hidden", "false");
        document.documentElement.classList.add("noScroll");
      }

      function closeLightbox() {
        lb.classList.remove("isOpen");
        lb.setAttribute("aria-hidden", "true");
        document.documentElement.classList.remove("noScroll");
      }

      function step(dir) {
        const imgs = imagesForProject(activeProjectIndex);
        if (!imgs.length) return;
        const next = (activeImageIndex + dir + imgs.length) % imgs.length;
        openLightbox(activeProjectIndex, next);
      }

      document.addEventListener("click", (e) => {
        const img = e.target.closest("[data-lightbox]");
        if (!img) return;
        const pi = Number(img.getAttribute("data-lightbox") || "0");
        const ii = Number(img.getAttribute("data-i") || "0");
        openLightbox(pi, ii);
      });

      lbClose?.addEventListener("click", closeLightbox);
      lb?.addEventListener("click", (e) => { if (e.target === lb) closeLightbox(); });
      lbPrev?.addEventListener("click", () => step(-1));
      lbNext?.addEventListener("click", () => step(1));

      window.addEventListener("keydown", (e) => {
        if (!lb.classList.contains("isOpen")) return;
        if (e.key === "Escape") closeLightbox();
        if (e.key === "ArrowLeft") step(-1);
        if (e.key === "ArrowRight") step(1);
      });

      function escapeHtml(str) {
        return (str || "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      
// --- Substack (latest posts) ---
// Uses AllOrigins (CORS relay) + a short local cache so GitHub Pages always feels snappy,
// and a cache-buster so you reliably get the newest posts.
async function loadSubstack(force = false) {
  const mount = document.getElementById("postsMount");
  if (!mount) return;

  const refreshBtn = document.getElementById("postsRefresh");

  const FEED = "https://tekofm.substack.com/feed";
  const RELAY = "https://api.allorigins.win/raw?url=";
  const POSTS_MAX = 6;

  const CACHE_KEY = "tete_substack_cache_v4";
  const CACHE_TTL_MS = 10 * 60 * 1000; // 10 minutes

  const escapeHtml = (str) => (str || "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");

  const formatDate = (pub) => {
    try {
      const d = new Date(pub);
      if (Number.isNaN(d.getTime())) return pub || "";
      return d.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "2-digit" });
    } catch {
      return pub || "";
    }
  };

  const render = (items, note) => {
    const take = (items || []).slice(0, POSTS_MAX);
    if (!take.length) {
      mount.innerHTML = `<div class="postsEmpty">No posts found. <a href="https://tekofm.substack.com/" target="_blank" rel="noopener">Open Substack</a>.</div>`;
      return;
    }

    mount.innerHTML = take.map((it) => {
      const title = it.title || "Untitled";
      const link = it.link || "https://tekofm.substack.com/";
      const pub = it.pubDate || "";
      return `
        <article class="postItem">
          <p class="postMeta">${escapeHtml(formatDate(pub))}${note ? ` · ${escapeHtml(note)}` : ""}</p>
          <h3 class="postTitle"><a href="${escapeHtml(link)}" target="_blank" rel="noopener">${escapeHtml(title)}</a></h3>
        </article>
      `;
    }).join("");
  };

  const setLoading = (msg = "Loading posts…") => {
    mount.innerHTML = `<div class="postsEmpty">${escapeHtml(msg)}</div>`;
  };

  // Hook up refresh button once
  if (refreshBtn && !refreshBtn.dataset.bound) {
    refreshBtn.dataset.bound = "1";
    refreshBtn.addEventListener("click", () => {
      try { localStorage.removeItem(CACHE_KEY); } catch {}
      loadSubstack(true);
    });
  }

  try {
    // Try cache first (unless forced)
    if (!force) {
      try {
        const raw = localStorage.getItem(CACHE_KEY);
        if (raw) {
          const cached = JSON.parse(raw);
          if (cached?.ts && Array.isArray(cached?.items) && (Date.now() - cached.ts) < CACHE_TTL_MS) {
            render(cached.items, "cached");
            // Continue in background to refresh quietly
            // (doesn't block rendering)
          }
        }
      } catch {}
    }

    setLoading("Loading latest posts…");

    // Cache-buster to avoid stale RSS on GH Pages / proxies
    const bust = Date.now();
    const url = RELAY + encodeURIComponent(`${FEED}?_=${bust}`);

    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const xmlText = await res.text();

    const doc = new DOMParser().parseFromString(xmlText, "text/xml");
    const items = [...doc.querySelectorAll("item")].map((item) => ({
      title: item.querySelector("title")?.textContent || "",
      link: item.querySelector("link")?.textContent || "",
      pubDate: item.querySelector("pubDate")?.textContent || ""
    }));

    if (!items.length) throw new Error("No RSS items");

    try {
      localStorage.setItem(CACHE_KEY, JSON.stringify({ ts: Date.now(), items }));
    } catch {}

    render(items, "updated");
  } catch (err) {
    mount.innerHTML = `<div class="postsEmpty">Couldn’t load posts right now. <a href="https://tekofm.substack.com/" target="_blank" rel="noopener">Open Substack</a>.</div>`;
  }
}

loadSubstack();
    })();
  </script>
</body>
</html>
