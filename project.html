<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>tete — project</title>

  <style>
    :root{
      --bg:#0b0b0b;
      --ink:#f4f4f4;
      --muted:rgba(244,244,244,.74);
      --hair:rgba(244,244,244,.12);
      --accent:#ff9500;
      --max:1120px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:var(--max);margin:0 auto;padding:0 18px}

    /* HERO */
    .hero{position:relative;height:min(72vh,720px);border-bottom:1px solid rgba(255,255,255,.06);overflow:hidden}
    .hero img{width:100%;height:100%;object-fit:cover;display:block;cursor:zoom-in;filter:saturate(108%) contrast(106%)}
    .hero::after{
      content:"";position:absolute;inset:0;
      background:
        linear-gradient(to top, rgba(0,0,0,.86) 0%, rgba(0,0,0,.30) 58%, rgba(0,0,0,.18) 100%);
      pointer-events:none
    }
    .heroOverlay{position:absolute;left:0;right:0;bottom:0;padding:22px 0 20px}
    .kicker{display:flex;align-items:center;gap:12px;font-size:12px;letter-spacing:.22em;text-transform:uppercase;color:rgba(255,255,255,.78)}
    .kicker .line{width:60px;height:1px;background:var(--accent)}
    h1{margin:10px 0 10px;font-size:clamp(40px,5vw,74px);line-height:.95;letter-spacing:-.02em}
    .desc{margin:0;max-width:62ch;color:rgba(255,255,255,.88);line-height:1.55}
    .meta{margin-top:14px;display:flex;gap:14px;flex-wrap:wrap;font-size:12px;letter-spacing:.12em;color:rgba(255,255,255,.72)}
    .meta b{color:var(--accent);font-weight:700}

    /* CONTENT */
    main{padding:22px 0 40px}
    .gTitle{display:flex;align-items:center;gap:12px;color:rgba(255,255,255,.72);font-size:12px;letter-spacing:.22em;text-transform:uppercase;margin:0 0 12px}
    .gTitle .line{width:44px;height:1px;background:var(--accent)}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:620px){.grid{grid-template-columns:1fr}}

    .thumb{border:0;background:transparent;padding:0;position:relative;cursor:zoom-in}
    .thumb img{
      width:100%;
      height:260px;
      object-fit:cover;
      border:1px solid rgba(255,255,255,.10);
      display:block;
      transition:transform .18s ease, border-color .18s ease, filter .18s ease;
      filter:saturate(108%) contrast(106%);
    }
    .thumb:hover img{
      border-color:rgba(255,149,0,.48);
      transform:scale(1.01);
    }
    .zoom{
      position:absolute;right:10px;bottom:10px;
      width:34px;height:34px;
      border:1px solid rgba(255,255,255,.18);
      display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,.35);
      opacity:0;transform:translateY(3px);
      transition:opacity .18s ease, transform .18s ease, border-color .18s ease;
      pointer-events:none;
      font-size:18px; line-height:1;
    }
    .thumb:hover .zoom{opacity:1;transform:translateY(0);border-color:rgba(255,149,0,.55)}

    .build{
      margin-top:14px;
      color:rgba(255,255,255,.55);
      font-size:12px;
      letter-spacing:.12em;
    }

    /* LIGHTBOX */
    #lightbox{display:none}
    body.lbOpen #lightbox{display:block}
    body.lbOpen{overflow:hidden}

    .lbScrim{position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:9998}
    .lbFrame{
      position:fixed; inset:0; z-index:9999;
      display:grid; grid-template-columns:64px 1fr 64px;
      align-items:center; padding:22px;
    }
    @media(max-width:700px){.lbFrame{grid-template-columns:52px 1fr 52px;padding:14px}}
    .lbFigure{margin:0;display:flex;flex-direction:column;align-items:center;gap:10px}
    .lbImg{
      max-width:min(1100px,88vw);
      max-height:82vh;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.02);
      object-fit:contain;
    }
    .lbCap{font-size:12px;color:rgba(255,255,255,.72);text-align:center;letter-spacing:.08em}
    .lbClose{
      position:fixed;top:14px;right:14px;width:44px;height:40px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      color:#fff;cursor:pointer;z-index:10000;
    }
    .lbNav{
      width:52px;height:52px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      color:#fff;cursor:pointer;justify-self:center;
      font-size:20px;
    }
    .lbClose:hover,.lbNav:hover{border-color:rgba(255,149,0,.55)}
  </style>
</head>

<body>
  <section class="hero">
    <img id="heroImg" src="./images/project-01-a.jpg" alt="Project image" />
    <div class="heroOverlay">
      <div class="wrap">
        <div class="kicker"><span class="line"></span><span id="subtitle">Selected Works</span></div>
        <h1 id="title">Project</h1>
        <p id="desc" class="desc"></p>
        <div class="meta">
          <span><b>Year</b> <span id="year">—</span></span>
          <span><b>Location</b> <span id="location">—</span></span>
          <span><b>Scope</b> <span id="scope">—</span></span>
        </div>
      </div>
    </div>
  </section>

  <main class="wrap">
    <div class="gTitle"><span class="line"></span><span>Gallery</span></div>
    <div class="grid" id="grid"></div>
    <div class="build">BUILD: v4 (click any image to expand)</div>
  </main>

  <!-- Lightbox (static, not injected) -->
  <div id="lightbox" aria-hidden="true">
    <div class="lbScrim" id="lbCloseScrim"></div>
    <div class="lbFrame" role="dialog" aria-modal="true" aria-label="Image viewer">
      <button class="lbNav" id="lbPrev" type="button" aria-label="Previous">←</button>
      <figure class="lbFigure">
        <img class="lbImg" id="lbImg" src="" alt="" />
        <figcaption class="lbCap" id="lbCap"></figcaption>
      </figure>
      <button class="lbNav" id="lbNext" type="button" aria-label="Next">→</button>

      <button class="lbClose" id="lbCloseBtn" type="button" aria-label="Close">✕</button>
    </div>
  </div>

  <script src="./projects.js"></script>
  <script>
    const $ = (s) => document.querySelector(s);

    function getParam(name){
      const u = new URL(location.href);
      return (u.searchParams.get(name) || "").trim();
    }

    function pickProject(){
      const list = Array.isArray(window.PROJECTS) ? window.PROJECTS : [];
      const key = getParam("p");
      return list.find(p => p.slug === key) || list[0] || null;
    }

    const project = pickProject();
    if (!project) {
      document.body.innerHTML = "<div style='padding:24px;font-family:system-ui'>No projects found.</div>";
      throw new Error("No projects found.");
    }

    // Fill hero
    document.title = `tete — ${project.title}`;
    $("#subtitle").textContent = project.subtitle || "Selected Works";
    $("#title").textContent = project.title || "Project";
    $("#desc").textContent = project.description || "";
    $("#year").textContent = project.year || "—";
    $("#location").textContent = project.location || "—";
    $("#scope").textContent = (project.scope || []).join(" · ") || "—";

    const images = (project.images || []).filter(Boolean);
    const hero = images[0];
    if (hero) {
      $("#heroImg").src = hero.src;
      $("#heroImg").alt = hero.alt || project.title || "Project image";
    }

    // Build grid
    const grid = $("#grid");
    grid.innerHTML = images.map((img, i) => `
      <button class="thumb" type="button" data-i="${i}">
        <img src="${img.src}" alt="${img.alt || ""}" loading="lazy" decoding="async" />
        <span class="zoom">+</span>
      </button>
    `).join("");

    // Lightbox logic
    let idx = 0;
    const lb = $("#lightbox");
    const lbImg = $("#lbImg");
    const lbCap = $("#lbCap");

    function openLB(i){
      idx = (i + images.length) % images.length;
      const it = images[idx];
      lbImg.src = it.src;
      lbImg.alt = it.alt || "";
      lbCap.textContent = `Image ${idx + 1} of ${images.length}${it.alt ? " — " + it.alt : ""}`;
      document.body.classList.add("lbOpen");
      lb.setAttribute("aria-hidden","false");
    }
    function closeLB(){
      document.body.classList.remove("lbOpen");
      lb.setAttribute("aria-hidden","true");
    }
    function next(){ openLB(idx + 1); }
    function prev(){ openLB(idx - 1); }

    // Click hero opens
    $("#heroImg").addEventListener("click", () => openLB(0));

    // Click thumbs open
    grid.addEventListener("click", (e) => {
      const btn = e.target.closest(".thumb");
      if (!btn) return;
      openLB(Number(btn.getAttribute("data-i") || "0"));
    });

    // Controls
    $("#lbCloseScrim").addEventListener("click", closeLB);
    $("#lbCloseBtn").addEventListener("click", closeLB);
    $("#lbNext").addEventListener("click", next);
    $("#lbPrev").addEventListener("click", prev);

    document.addEventListener("keydown", (e) => {
      if (!document.body.classList.contains("lbOpen")) return;
      if (e.key === "Escape") closeLB();
      if (e.key === "ArrowRight") next();
      if (e.key === "ArrowLeft") prev();
    });

    console.log("[tete] project.html lightbox v4 loaded");
  </script>
</body>
</html>
